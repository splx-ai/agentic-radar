# Visual Testing and Screenshot Documentation Workflow

## Overview
This document describes the automated visual testing and screenshot generation system for documenting PR changes that affect the user interface.

## Purpose
- **Visual Proof**: Provide screenshots showing actual rendered output
- **Regression Prevention**: Catch visual issues before they reach production  
- **Review Assistance**: Help reviewers understand visual impact of changes
- **Documentation**: Create visual records of UI improvements

## When Screenshots Are Generated

### Automatic Triggers (GitHub Actions)
Screenshots are automatically generated when PRs modify:
- `agentic_radar/report/templates/**` (HTML templates)
- `agentic_radar/report/graph/**` (Graph generation)  
- `agentic_radar/cli.py` (CLI interface)
- `agentic_radar/report/report.py` (Report generation)

### Manual Generation
```bash
# Generate screenshots locally
python scripts/generate-pr-screenshots.py

# Run specific visual tests
python -m pytest tests/test_visual_ux_capture.py -v -s
```

## Screenshot Categories

### 1. Full Report Screenshots
- **Purpose**: Show complete HTML report with all sections
- **Captures**: Header, navigation, graph, tables, styling
- **Viewports**: Desktop (1920x1080), Tablet (1024x768), Mobile (375x667)

### 2. Graph-Only Screenshots  
- **Purpose**: Show minimal graph visualization (--graph-only flag)
- **Captures**: SPLX branding, graph container, controls, styling
- **Formats**: Both ForceGraph.js and vis.js versions

### 3. Visualization Comparison
- **Purpose**: Side-by-side comparison of visualization libraries
- **Captures**: ForceGraph.js vs vis.js rendering of same data
- **Validates**: Format compatibility, visual consistency

### 4. Interactive Elements
- **Purpose**: Show hover states, click interactions, responsive behavior
- **Captures**: Control tooltips, node interactions, responsive layouts
- **Browser**: Real Chromium browser testing with Playwright

## Technical Implementation

### Test Structure
```python
@pytest.mark.browser
class TestVisualUXCapture:
    """Capture screenshots of working UX for visual regression testing."""
    
    def test_capture_full_report_screenshot(self, tmp_path):
        # Generate real report using CLI
        # Open in browser  
        # Capture screenshots
        # Save with descriptive names
```

### Browser Automation
- **Engine**: Playwright with Chromium
- **Headless**: Yes (for CI/CD)
- **Viewports**: Multiple sizes for responsive testing
- **Wait Logic**: Ensures JavaScript execution completes
- **Error Detection**: Monitors console for JavaScript errors

### File Naming Convention
```
{category}_{description}_{viewport}.png

Examples:
- full_report_screenshot_desktop.png
- graph_only_screenshot.png  
- force_graph_screenshot.png
- vis_js_screenshot.png
- responsive_tablet_screenshot.png
```

## GitHub Actions Integration

### Workflow Trigger
```yaml
on:
  pull_request:
    branches: [ main ]
    paths:
      - 'agentic_radar/report/templates/**'
      - 'agentic_radar/report/graph/**'
      - 'agentic_radar/cli.py'
      - 'agentic_radar/report/report.py'
```

### Process Flow
1. **Setup Environment**: Python 3.11, install dependencies, Playwright
2. **Generate Screenshots**: Run visual test suite
3. **Upload Artifacts**: Save screenshots with PR number
4. **Comment on PR**: Add markdown comment with download links

### PR Comment Format
```markdown
## ðŸ“¸ Visual Changes Preview

Screenshots have been generated to show the visual impact of these changes.

**Generated Screenshots:**
- Full Report (Complete HTML report with all sections)
- Graph Only (Minimal graph visualization)  
- Visualization Comparison (ForceGraph.js vs vis.js)
- Responsive Views (Desktop, tablet, mobile)

**Download Screenshots:** [View Artifacts](link-to-artifacts)

> ðŸ¤– Screenshots automatically generated by GitHub Actions
```

## Local Development Workflow

### 1. Make UI Changes
Edit templates, styling, or graph generation code

### 2. Test Changes
```bash
# Run visual tests to see current output
python -m pytest tests/test_visual_ux_capture.py -v -s

# Check specific test
python -m pytest tests/test_visual_ux_capture.py::TestVisualUXCapture::test_capture_graph_only_screenshot -v -s
```

### 3. Generate PR Documentation
```bash
# Generate screenshots and PR comment
python scripts/generate-pr-screenshots.py

# Review generated markdown
cat pr-screenshots/PR_COMMENT.md
```

### 4. Include in PR Description
Copy the generated markdown into your PR description to provide visual context.

## Best Practices

### For Developers
- **Run Tests Locally**: Generate screenshots before pushing
- **Review Output**: Check that visual changes match expectations
- **Document Intent**: Explain visual changes in PR description
- **Test Multiple Formats**: Verify both ForceGraph.js and vis.js if applicable

### For Reviewers  
- **Download Screenshots**: View actual rendered output
- **Compare Before/After**: Look for unintended visual changes
- **Check Responsiveness**: Review mobile/tablet layouts
- **Validate Interactions**: Ensure UI elements work correctly

### For CI/CD
- **Artifact Retention**: Screenshots kept for 30 days
- **Failure Handling**: Tests continue even if screenshots fail
- **Performance**: Tests timeout after 60 seconds
- **Environment**: Consistent browser and viewport settings

## Troubleshooting

### Common Issues
1. **Missing Example Data**: Tests need valid input directories
2. **Playwright Installation**: May need `playwright install chromium`
3. **Timeout Errors**: Increase wait times for complex graphs
4. **Permission Issues**: Ensure write access to output directories

### Test Environment
```bash
# Verify Playwright installation
playwright --version

# Test browser launch
python -c "from playwright.sync_api import sync_playwright; p = sync_playwright().start(); p.chromium.launch(); p.stop()"

# Check example data
ls examples/langgraph/customer_service/
```

## Future Enhancements

### Visual Regression Testing
- **Baseline Comparison**: Compare screenshots against known-good versions
- **Diff Detection**: Highlight visual changes between versions  
- **Approval Workflow**: Manual approval for intentional visual changes

### Enhanced Coverage
- **Error States**: Screenshots of error conditions
- **Loading States**: Capture intermediate loading screens
- **Animation Testing**: Validate smooth transitions
- **Accessibility**: Color contrast and keyboard navigation testing

---

**This workflow ensures that visual changes are properly documented and reviewed, maintaining the quality and consistency of the user interface.**